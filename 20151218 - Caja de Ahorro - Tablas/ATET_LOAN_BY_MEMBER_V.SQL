CREATE OR REPLACE VIEW APPS.ATET_LOAN_BY_MEMBER_V
AS
SELECT TRIM(TO_CHAR(SUM(NVL(ASPS.OWED_CAPITAL, ASPS.PAYMENT_CAPITAL)) +
                    SUM(NVL(ASPS.OWED_INTEREST, ASPS.PAYMENT_INTEREST)), '$999,999.99')
                    || DECODE(SUM(NVL(ASPS.OWED_INTEREST_LATE, ASPS.PAYMENT_INTEREST_LATE)),
                              0, '',
                              ' MORATORIO ' || TRIM(TO_CHAR(SUM(NVL(ASPS.OWED_INTEREST_LATE, ASPS.PAYMENT_INTEREST_LATE)), '$999,999.99')))) AMOUNT, 
       ASL.LOAN_NUMBER,
       ASL.LOAN_ID,
       ASL.MEMBER_ID
  FROM ATET_SB_LOANS ASL, 
       ATET_SB_PAYMENTS_SCHEDULE ASPS
 WHERE 1 = 1
   AND ASL.LOAN_ID = ASPS.LOAN_ID
   AND ASL.LOAN_STATUS_FLAG = 'ACTIVE'
   AND ASPS.STATUS_FLAG IN ('PENDING', 'SKIP', 'PARTIAL')
 GROUP 
    BY ASL.LOAN_NUMBER, 
       ASL.LOAN_ID,
       ASL.MEMBER_ID
 ORDER 
    BY TO_NUMBER (ASL.LOAN_NUMBER);
 
 
