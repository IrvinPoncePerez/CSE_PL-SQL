SELECT ASS.ASSET_NUMBER,
       ASS.OWNED_LEASED,
       ASS.NEW_USED,
       ASS.ATTRIBUTE_CATEGORY_CODE,
       ASS.DESCRIPTION,
       ASS.BOOK_TYPE_CODE,
       ASS.SEGMENT1,
       ASS.SEGMENT2,
       ASS.COMPANY_CODE, 
       ASS.COMPANY_DESC, 
       ASS.CC_CODE, 
       ASS.CC_DESC, 
       ASS.TRANSACTION_TYPE_CODE,
       ASS.DATE_PLACED_IN_SERVICE,
       ASS.COST, 
       ASS.UNITS_ASSIGNED,
       --DATOS DE ORIGEN
       FTH.TRANSACTION_TYPE_CODE,        
       FR.DATE_RETIRED,
       FR.COST_RETIRED,
       FR.UNITS,
       FR.REFERENCE_NUM,
       FR.SOLD_TO
  FROM (SELECT 
               FA.ASSET_ID,
               FA.ASSET_NUMBER,
               FA.OWNED_LEASED,
               FA.NEW_USED,
               FA.ATTRIBUTE_CATEGORY_CODE,
               FAT.DESCRIPTION,
               FDH.BOOK_TYPE_CODE,
               FDH.UNITS_ASSIGNED,
               GCC.SEGMENT1                 AS  COMPANY_CODE, 
               FFVT_CIA.DESCRIPTION         AS  COMPANY_DESC, 
               GCC.SEGMENT2                 AS  CC_CODE, 
               FFVT_CC.DESCRIPTION          AS  CC_DESC, 
               FB.DATE_PLACED_IN_SERVICE, 
               FB.COST, 
               FL.SEGMENT1,
               FL.SEGMENT2,
               FDH.RETIREMENT_ID,
               FB.TRANSACTION_HEADER_ID_IN,
               FB.TRANSACTION_HEADER_ID_OUT,
               FTH.TRANSACTION_TYPE_CODE,
               FTH.TRANSACTION_DATE_ENTERED
          FROM FA_ADDITIONS_B           FA,
               FA_ADDITIONS_TL          FAT,
               FA_DISTRIBUTION_HISTORY  FDH,
               FA_LOCATIONS             FL,
               GL_CODE_COMBINATIONS     GCC,
               FND_FLEX_VALUE_SETS      FFVS_CC,
               FND_FLEX_VALUES          FFV_CC,
               FND_FLEX_VALUES_TL       FFVT_CC,
               FND_FLEX_VALUE_SETS      FFVS_CIA,
               FND_FLEX_VALUES          FFV_CIA,
               FND_FLEX_VALUES_TL       FFVT_CIA,
               FA_BOOKS                 FB,
               FA_TRANSACTION_HEADERS   FTH
         WHERE 1 = 1
           AND FA.ASSET_ID = FAT.ASSET_ID
           AND FAT.LANGUAGE = USERENV('LANG')
           AND FA.ASSET_ID = FDH.ASSET_ID
           AND FDH.LOCATION_ID = FL.LOCATION_ID
           AND FDH.CODE_COMBINATION_ID = GCC.CODE_COMBINATION_ID
           AND FFVS_CC.FLEX_VALUE_SET_NAME = 'CC_ CALVARIO'
           AND FFV_CC.FLEX_VALUE_SET_ID = FFVS_CC.FLEX_VALUE_SET_ID
           AND FFV_CC.FLEX_VALUE_ID = FFVT_CC.FLEX_VALUE_ID
           AND FFVT_CC.LANGUAGE = USERENV ('LANG')
           AND FFV_CC.ENABLED_FLAG = 'Y'
           AND FFV_CC.FLEX_VALUE = GCC.SEGMENT2
           AND FFVS_CIA.FLEX_VALUE_SET_NAME = 'CIA_CALVARIO'
           AND FFV_CIA.FLEX_VALUE_SET_ID = FFVS_CIA.FLEX_VALUE_SET_ID
           AND FFV_CIA.FLEX_VALUE_ID = FFVT_CIA.FLEX_VALUE_ID
           AND FFVT_CIA.LANGUAGE = USERENV ('LANG')
           AND FFV_CIA.ENABLED_FLAG = 'Y'
           AND FFV_CIA.FLEX_VALUE = GCC.SEGMENT1
           AND FB.BOOK_TYPE_CODE = FDH.BOOK_TYPE_CODE
           AND FB.ASSET_ID = FA.ASSET_ID
           AND FTH.ASSET_ID = FA.ASSET_ID
           AND FTH.TRANSACTION_HEADER_ID = FB.TRANSACTION_HEADER_ID_IN
       ) ASS
  LEFT JOIN FA_RETIREMENTS          FR
    ON (FR.RETIREMENT_ID = ASS.RETIREMENT_ID AND FR.ASSET_ID = ASS.ASSET_ID)
  LEFT JOIN FA_TRANSACTION_HEADERS  FTH
    ON (FTH.TRANSACTION_HEADER_ID = ASS.TRANSACTION_HEADER_ID_OUT)
 WHERE 1 = 1
   AND FR.SOLD_TO IS NOT NULL
   AND ASS.TRANSACTION_HEADER_ID_IN <> FTH.TRANSACTION_HEADER_ID
   AND ASS.ASSET_NUMBER = 1049;
   

   
--PO_VENDORS PO, 
--FA_ASSET_INVOICES AI,
--FA_INVOICE_DETAILS_V,


