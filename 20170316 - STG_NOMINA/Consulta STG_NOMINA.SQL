SELECT FLV1.LOOKUP_CODE                         AS  COMPANIA_CLAVE,
       FLV1.MEANING                             AS  COMPANIA_NOMBRE,  
       PPG.SEGMENT1                             AS  AREA_CLAVE,
       FFVT_A.DESCRIPTION                       AS  AREA_NOMBRE,  
       FFV_G.FLEX_VALUE                         AS  GERENCIA_CLAVE,
       FFVT_G.DESCRIPTION                       AS  GERENCIA_NOMBRE,
       FFV_D.FLEX_VALUE                         AS  DEPTO_CLAVE,
       FFVT_D.DESCRIPTION                       AS  DEPTO_NOMBRE,
       FFV_CC.FLEX_VALUE                        AS  CENTRO_COSTOS_CLAVE,
       FFVT_CC.DESCRIPTION                      AS  CENTRO_COSTOS_NOMBRE,  
       PPD.SEGMENT3                             AS  PUESTO_CLAVE,
       PPD.SEGMENT2                             AS  PUESTO_DEPTO,
       PPD.SEGMENT1                             AS  PUESTO_NOMBRE,
       PPF.ATTRIBUTE1                           AS  NOMINA_CLAVE,
       PPF.PAYROLL_NAME                         AS  NOMINA_NOMBRE,
       PCS.CONSOLIDATION_SET_NAME               AS  NOMINA_CONCEPTO,
       PPA.EFFECTIVE_DATE                       AS  NOMINA_FECHA,
       PTP.PERIOD_TYPE                          AS  NOMINA_TIPO_PERIODO,
       (PTP.END_DATE + 1) - PTP.START_DATE      AS  NOMINA_DIAS,
       PAPF.EMPLOYEE_NUMBER                     AS  EMPLEADO_NUMERO,
       PAPF.FULL_NAME                           AS  EMPLEADO_NOMBRE,
       PAPF.SEX                                 AS  EMPLEADO_SEXO,
       PAPF.DATE_OF_BIRTH                       AS  EMPLEADO_FECHA_NACIMIENTO,
       SUM(PPP.VALUE)                           AS  NOMINA_MONTO
  FROM PER_ALL_PEOPLE_F             PAPF,
       PER_ALL_ASSIGNMENTS_F        PAAF,    
       PAY_PAYROLLS_F               PPF,
       PAY_PAYROLL_ACTIONS          PPA,
       PER_TIME_PERIODS             PTP,
       PAY_CONSOLIDATION_SETS       PCS,
       PAY_PAYROLL_ACTIONS          PPA_PP,
       PAY_ASSIGNMENT_ACTIONS       PAA,
       PAY_PRE_PAYMENTS             PPP,
       FND_LOOKUP_VALUES            FLV1,
       PAY_PEOPLE_GROUPS            PPG,
       FND_FLEX_VALUE_SETS          FFVS_A,
       FND_FLEX_VALUES              FFV_A,
       FND_FLEX_VALUES_TL           FFVT_A,
       PER_POSITION_DEFINITIONS     PPD,
       HR_ALL_POSITIONS_F           HAPF,
       HR_ORGANIZATION_UNITS        HOU,
       FND_FLEX_VALUE_SETS          FFVS_D,
       FND_FLEX_VALUES              FFV_D,
       FND_FLEX_VALUES_TL           FFVT_D,
       FND_FLEX_VALUE_SETS          FFVS_CC,
       FND_FLEX_VALUES              FFV_CC,
       FND_FLEX_VALUES_TL           FFVT_CC,
       FND_FLEX_VALUE_SETS          FFVS_G,
       FND_FLEX_VALUES              FFV_G,
       FND_FLEX_VALUES_TL           FFVT_G
 WHERE 1 = 1
   AND PAPF.PERSON_ID = PAAF.PERSON_ID
   AND PAAF.PAYROLL_ID = PPF.PAYROLL_ID
   AND PPF.PAYROLL_ID = PPA.PAYROLL_ID
   AND PPF.PAYROLL_ID = PTP.PAYROLL_ID
   AND PTP.TIME_PERIOD_ID = PPA.TIME_PERIOD_ID
   AND PPA.CONSOLIDATION_SET_ID = PCS.CONSOLIDATION_SET_ID
   AND PPF.PAYROLL_ID = PPA_PP.PAYROLL_ID
   AND PCS.CONSOLIDATION_SET_ID = PPA_PP.CONSOLIDATION_SET_ID
   AND PPA.EFFECTIVE_DATE = PPA_PP.EFFECTIVE_DATE
   AND PPA_PP.PAYROLL_ACTION_ID = PAA.PAYROLL_ACTION_ID
   AND PAA.ASSIGNMENT_ID = PAAF.ASSIGNMENT_ID
   AND PAA.ASSIGNMENT_ACTION_ID = PPP.ASSIGNMENT_ACTION_ID
   AND PPD.POSITION_DEFINITION_ID = HAPF.POSITION_DEFINITION_ID
   AND PAAF.POSITION_ID = HAPF.POSITION_ID
   AND PAAF.ORGANIZATION_ID = HOU.ORGANIZATION_ID
   AND PPA.EFFECTIVE_DATE
       BETWEEN PPF.EFFECTIVE_START_DATE
           AND PPF.EFFECTIVE_END_DATE
   AND PPA.EFFECTIVE_DATE 
       BETWEEN PTP.START_DATE
           AND PTP.END_DATE
   AND PPA.EFFECTIVE_DATE
       BETWEEN PAPF.EFFECTIVE_START_DATE    
           AND PAPF.EFFECTIVE_END_DATE
   AND PPA.EFFECTIVE_DATE
       BETWEEN PAAF.EFFECTIVE_START_DATE
           AND PAAF.EFFECTIVE_END_DATE 
   AND PPA_PP.ACTION_TYPE IN ('P')
   AND FLV1.LOOKUP_TYPE = 'NOMINAS POR EMPLEADOR LEGAL'
   AND FLV1.LOOKUP_CODE = SUBSTR(PPF.PAYROLL_NAME,0,2)
   AND FLV1.LANGUAGE = USERENV('LANG')
   AND FFVS_A.FLEX_VALUE_SET_NAME = 'CALV_AREA'
   AND FFVS_A.FLEX_VALUE_SET_ID = FFV_A.FLEX_VALUE_SET_ID
   AND FFV_A.FLEX_VALUE_ID = FFVT_A.FLEX_VALUE_ID
   AND FFVT_A.LANGUAGE = USERENV('LANG')
   AND PPG.SEGMENT1 = FFV_A.FLEX_VALUE
   AND PPG.PEOPLE_GROUP_ID = PAAF.PEOPLE_GROUP_ID
   AND FFVS_D.FLEX_VALUE_SET_NAME = 'XXCALV_DEPA'
   AND FFV_D.FLEX_VALUE_SET_ID = FFVS_D.FLEX_VALUE_SET_ID
   AND FFVT_D.LANGUAGE = USERENV('LANG')
   AND FFV_D.FLEX_VALUE_ID = FFVT_D.FLEX_VALUE_ID
   AND FFV_D.ENABLED_FLAG = 'Y'
   AND FFV_D.FLEX_VALUE = PPD.SEGMENT2 
   AND FFVS_CC.FLEX_VALUE_SET_NAME = 'CC_ CALVARIO'
   AND FFV_CC.FLEX_VALUE_SET_ID = FFVS_CC.FLEX_VALUE_SET_ID
   AND FFVT_CC.LANGUAGE = USERENV('LANG')
   AND FFV_CC.FLEX_VALUE_ID = FFVT_CC.FLEX_VALUE_ID
   AND FFV_CC.ENABLED_FLAG = 'Y'
   AND FFV_CC.FLEX_VALUE = HOU.ATTRIBUTE7
   AND FFVS_G.FLEX_VALUE_SET_NAME = 'CALV_GERENCIAS'
   AND FFVS_G.FLEX_VALUE_SET_ID = FFV_G.FLEX_VALUE_SET_ID
   AND FFV_G.FLEX_VALUE_ID = FFVT_G.FLEX_VALUE_ID
   AND FFVT_G.LANGUAGE = USERENV('LANG')
   AND PPG.SEGMENT2 = FFV_G.FLEX_VALUE
 GROUP 
    BY FLV1.LOOKUP_CODE,
       FLV1.MEANING,
       PPG.SEGMENT1,
       FFVT_A.DESCRIPTION,
       FFV_G.FLEX_VALUE,
       FFVT_G.DESCRIPTION,
       FFV_D.FLEX_VALUE,
       FFVT_D.DESCRIPTION,
       FFV_CC.FLEX_VALUE,
       FFVT_CC.DESCRIPTION,
       PPD.SEGMENT3,
       PPD.SEGMENT2,
       PPD.SEGMENT1,
       PPF.ATTRIBUTE1,
       PPF.PAYROLL_NAME,
       PCS.CONSOLIDATION_SET_NAME,
       PPA.EFFECTIVE_DATE,
       PTP.PERIOD_TYPE,
       PTP.END_DATE,
       PTP.START_DATE,
       PAPF.EMPLOYEE_NUMBER,
       PAPF.FULL_NAME,
       PAPF.SEX,
       PAPF.DATE_OF_BIRTH
 ORDER
    BY FLV1.LOOKUP_CODE,
       PPG.SEGMENT1,
       FFV_D.FLEX_VALUE,
       PAPF.EMPLOYEE_NUMBER,
       PPA.EFFECTIVE_DATE
   
   